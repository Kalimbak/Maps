<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="form">
        <form action="">
            <div>
                <p>Pickup point</p>
                <input type="text" id="pickup">
            </div>
            
            <div>
                <p>Dropoff point</p>
                <input type="text" id="dropoff">
            </div>
            <div>
                <p>Driver</p>
                <input type="text" id="driver">
            </div>
        </form>
    </div>
    <div id="mapid"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var mymap = L.map('mapid').setView([-1.9441, 30.0619], 13);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            // attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
        }).addTo(mymap);

        // Add a satellite view layer
        var satelliteLayer = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });

        // Create a base layer group with the OpenStreetMap and satellite layers
        var baseLayers = {
            "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
            "Satellite View": satelliteLayer
        };

        // Add the base layer group to the map
        L.control.layers(baseLayers).addTo(mymap);

        var marker = L.marker([-1.9441, 30.0619], {
            draggable: true
        }).addTo(mymap);

        function updateMarkerLocation(marker) {
            var latlng = marker.getLatLng();
            var lat = latlng.lat;
            var lng = latlng.lng;

            var url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=" + lat + "&lon=" + lng;

            fetch(url)
                .then(function(response) {
                    return response.json();
                })
                .then(function(json) {
                    var name = json.display_name;
                    document.getElementById("pickup").value = name;
                });
        }

        marker.on("moveend", function(event) {
            updateMarkerLocation(event.target);
        });

        updateMarkerLocation(marker);
        var socket = io();
        socket.on('location', function(location) {
            console.log('Received location update:', location);
            document.getElementById('latitude').value = location.latitude;
        });
    </script>
</body>
</html>
